name: Read the Docs Trigger

on:
  push:
    branches: ["main"]
    tags:
      - "v*"
  workflow_dispatch:

jobs:
  trigger:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Trigger Read the Docs build
        env:
          RTD_TOKEN: ${{ secrets.READTHEDOCS_TOKEN }}
          RTD_PROJECT: cellucid
          REF_TYPE: ${{ github.ref_type }}
          REF_NAME: ${{ github.ref_name }}
        run: |
          set -euo pipefail
          version="latest"
          if [ "$REF_TYPE" = "tag" ]; then
            version="$REF_NAME"
          fi
          echo "Triggering Read the Docs build for version ${version}"
          curl --fail -X POST \
            -H "Authorization: Token ${RTD_TOKEN}" \
            "https://readthedocs.org/api/v3/projects/${RTD_PROJECT}/versions/${version}/builds/"
